## Vmware 安装 CentOS 7

> [北京大学开源镜像站 centos/7/isos/x86_64](https://mirrors.pku.edu.cn/centos/7/isos/x86_64/) 下载 ISO 后会在后续引入，可以单独创建一个文件夹进行保存

![](https://oss.yiki.tech/gmall/202512171515978.png)

![](https://oss.yiki.tech/gmall/202512171515358.png)

![](https://oss.yiki.tech/gmall/202512171515462.png)

![](https://oss.yiki.tech/gmall/202512171515127.png)

![](https://oss.yiki.tech/gmall/202512171515120.png)

![](https://oss.yiki.tech/gmall/202512171516035.png)

![](https://oss.yiki.tech/gmall/202512171516985.png)

![](https://oss.yiki.tech/gmall/202512171516137.png)

![](https://oss.yiki.tech/gmall/202512171516604.png)

![](https://oss.yiki.tech/gmall/202512171516041.png)

![](https://oss.yiki.tech/gmall/202512171516666.png)

![](https://oss.yiki.tech/gmall/202512171516825.png)

![](https://oss.yiki.tech/gmall/202512171516961.png)

![](https://oss.yiki.tech/gmall/202512171516176.png)

![](https://oss.yiki.tech/gmall/202512171516824.png)

![](https://oss.yiki.tech/gmall/202512171516170.png)

![](https://oss.yiki.tech/gmall/202512171516930.png)

![](https://oss.yiki.tech/gmall/202512171516715.png)

![](https://oss.yiki.tech/gmall/202512171516394.png)

![](https://oss.yiki.tech/gmall/202512171517139.png)

![](https://oss.yiki.tech/gmall/202512171517993.png)

![](https://oss.yiki.tech/gmall/202512171517632.png)

![](https://oss.yiki.tech/gmall/202512171517257.png)

![](https://oss.yiki.tech/gmall/202512171517952.png)

![](https://oss.yiki.tech/gmall/202512171517638.png)

![](https://oss.yiki.tech/gmall/202512171517223.png)

![](https://oss.yiki.tech/gmall/202512171517893.png)

![](https://oss.yiki.tech/gmall/202512171517424.png)

![](https://oss.yiki.tech/gmall/202512171517131.png)

![](https://oss.yiki.tech/gmall/202512171517810.png)

## 配置静态 IP

```shell
# 修改虚拟机网络为固定 ip
vim /etc/sysconfig/network-scripts/ifcfg-ens33
```

```shell
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="static"                     # dhcp 自动获取IP 修改为静态
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="ens33"
UUID="6ab88256-68d3-4651-a4c2-19a20958d9c1"
DEVICE="ens33"
ONBOOT="yes"
IPADDR=192.168.0.101                    # 指定的固定 ip
NETMASK=255.255.255.0                   # 子网掩码
GATEWAY=192.168.0.1                     # 网关
DNS1=8.8.8.8                            # DNS 服务器
DNS2=114.114.114.114                    # DNS2 服务器
```

![](https://oss.yiki.tech/gmall/202512171523762.png)

```shell
# 重启网络
systemctl restart network.service

# 查看状态
firewall-cmd --state

# 停止防火墙
systemctl stop firewalld.service

# 禁止防火墙开机自启
systemctl disable firewalld.service 
```



## 更新 YUM 源

```shell
# 进入到/etc/yum.repos.d/目录下，备份之前的CentOS-Base.repo地址。
cd /etc/yum.repos.d/
mv CentOS-Base.repo CentOS-Base.repo.bak

# 下载阿里云yum源
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo

# 将服务器上的软件包信息缓存到本地,以提高搜索安装软件的速度
yum makecache
```

![](https://oss.yiki.tech/gmall/202512171524022.png)



## JDK 8

```shell
# 查询系统中自带的JDK
rpm -qa | grep jdk

# 卸载系统中自带的JDK rpm -e --nodeps jdk的rpm软件包的名字
rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.261-2.6.22.2.el7_8.x86_64
rpm -e --nodeps copy-jdk-configs-3.3-10.el7_5.noarch
rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.262.b10-1.el7.x86_64
rpm -e --nodeps java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64
rpm -e --nodeps java-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64
```

![](https://oss.yiki.tech/oss/202508080507986.png)

```shell
# 将文件下载到 /opt 目录下
cd /opt

wget https://download.java.net/openjdk/jdk8u44/ri/openjdk-8u44-linux-x64.tar.gz
```

```shell
# 解压后注意文件名称后续需要配置环境变量，此处解压后是 java-se-8u44-ri
tar -zxvf openjdk-8u44-linux-x64.tar.gz
```

![](https://oss.yiki.tech/gmall/202512171534829.png)

```shell
#  在/etc/profile.d目录下创建my\_env.sh文件(系统不建议直接修改/etc/profile)
cd /etc/profile.d
touch my_env.sh

vim my_env.sh

#JAVA_HOME  
JAVA_HOME=/opt/java-se-8u44-ri
PATH=$PATH:$JAVA_HOME/bin  
export PATH JAVA_HOME 
```

![](https://oss.yiki.tech/gmall/202512171533543.png)

```shell
# 使环境变量立即生效，如果不生效就重启
source /etc/profile.d/my_env.sh

# 查看 java 执行路径
which java

# 查看JAVA_HOME路径
echo $JAVA_HOME
```



## MySQL 8.0.31

```shell
# CentOS 7 默认安装 mariadb 先执行查询
rpm -qa|grep mariadb

# 如果存在mariadb执行删除 rpm -e --nodeps + 查询出来的名称
rpm -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64
```

![](https://oss.yiki.tech/gmall/202512171540253.png)

```shell
# 由于mysql安装过程中，会通过mysql用户在/tmp目录下新建tmp_db文件，所以请给/tmp较大的权限
chmod -R 777 /tmp
```

![](https://oss.yiki.tech/gmall/202512171540782.png)

```shell
# 进入指定目录并创建对应文件夹
cd /opt/

mkdir -p mysql
```

![](https://oss.yiki.tech/gmall/202512171540287.png)

```shell
# 进入创建目录并下载 MySQL 8 https://downloads.mysql.com/archives/community/
cd /opt/mysql
```

![](https://oss.yiki.tech/gmall/202512171541526.png)

![](https://oss.yiki.tech/gmall/202512171541609.png)

![](https://oss.yiki.tech/gmall/202512171541484.png)

```shell
# 解压到指定目录
tar -xvf mysql-8.0.31-1.el7.x86_64.rpm-bundle.tar -C /opt/mysql
```

![](https://oss.yiki.tech/gmall/202512171541463.png)

```shell
# 安装
yum install -y perl.x86_64

rpm -ivh mysql-community-common-8.0.31-1.el7.x86_64.rpm

rpm -ivh mysql-community-client-plugins-8.0.31-1.el7.x86_64.rpm

rpm -ivh mysql-community-libs-8.0.31-1.el7.x86_64.rpm

rpm -ivh mysql-community-client-8.0.31-1.el7.x86_64.rpm

rpm -ivh mysql-community-icu-data-files-8.0.31-1.el7.x86_64.rpm

rpm -ivh mysql-community-server-8.0.31-1.el7.x86_64.rpm
```

![](https://oss.yiki.tech/gmall/202512171541831.png)

![](https://oss.yiki.tech/gmall/202512171541040.png)

```shell
# 查看安装版本
mysqladmin --version
```

![](https://oss.yiki.tech/gmall/202512171541473.png)

```shell
# mysql 服务初始化. 安装成功后会生成一个密码, 我们可以通过这个密码进行连接
mysqld --initialize --user=mysql

# 启动 mysql 服务
systemctl start mysqld.service

# 查看密码
cat /var/log/mysqld.log

# 查看状态：
systemctl status mysqld.service
```

![](https://oss.yiki.tech/gmall/202512171542480.png)

```shell
# 首次登陆 mysql
mysql -hlocalhost -P3306 -uroot -p 回车,然后录入初始化密码
```

![](https://oss.yiki.tech/gmall/202512171542148.png)

```shell
# 修改密码
ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';
```

![](https://oss.yiki.tech/gmall/202512171542513.png)

```shell
# 查看远程连接权限
select host,user,select_priv,insert_priv from mysql.user;
```

![](https://oss.yiki.tech/gmall/202512171542725.png)

```shell
# 登陆后进入 mysql 库中
use mysql;

# 修改 root 账户的 host 地址
update user set host = '%' where user ='root';
```

![](https://oss.yiki.tech/gmall/202512171543300.png)

```shell
# 刷新, 并重新使用 可视化工具登陆
flush privileges;

exit
```

![](https://oss.yiki.tech/gmall/202512171543014.png)

![](https://oss.yiki.tech/gmall/202512171543220.png)

```shell
# 启动 mysql 服务
systemctl start mysqld.service

# 关闭：
systemctl stop mysqld.service

# 重启：
systemctl restart mysqld.service

# 查看状态：
systemctl status mysqld.service
```



## Redis 7.0.10

```shell
cd /opt

# 安装gcc依赖
yum install -y gcc

# 下载
wget http://download.redis.io/releases/redis-7.0.10.tar.gz
```

![](https://oss.yiki.tech/gmall/202512171545461.png)

```shell
# 解压
tar xzf redis-7.0.10.tar.gz

# 进入指定目录
cd /opt/redis-7.0.10
```

![](https://oss.yiki.tech/gmall/202512171545995.png)

```shell
# 安装并指定安装目录
make install PREFIX=/usr/local/redis

cd /usr/local/redis/bin/

# 从 redis 的源码目录中复制 redis.conf 到 redis 的安装目录
cp /opt/redis-7.0.10/redis.conf /usr/local/redis/bin/
```

![](https://oss.yiki.tech/gmall/202512171545710.png)

```shell
# 修改配置文件
vim /usr/local/redis/bin/redis.conf 

protected-mode no # 禁用 Redis 的保护模式
# bind 127.0.0.1  # Redis 会监听所有可用的网络接口（0.0.0.0），而不是仅限本地回环地址 127.0.0.1
daemonize yes     # 以守护进程（后台）模式运行 Redis
requirepass root  # 设置 requirepass 密码，密码在此处为 root
```

```shell
# 设置开机自启
vim /etc/systemd/system/redis.service

[Unit]
Description=redis-server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.conf
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

![](https://oss.yiki.tech/gmall/202512171545561.png)

```shell
# 创建 redis 命令软链接
ln -s /usr/local/redis/bin/redis-cli /usr/bin/redis

# 服务操作命令
systemctl start redis.service   #启动redis服务

systemctl stop redis.service   #停止redis服务

systemctl restart redis.service   #重新启动服务

systemctl status redis.service   #查看服务当前状态

systemctl enable redis.service   #设置开机自启动

systemctl disable redis.service   #停止开机自启动

# 杀死 redis 重启 redis
pkill -9 redis
ps aux | grep redis
systemctl start redis

# 查看 redis 状态
systemctl status redis.service
```

![](https://oss.yiki.tech/gmall/202512171545235.png)



## Spring Cloud Alibaba

### Nacos 2.0.3

```shell
mkdir /opt/cloud
mkdir /opt/cloud/logs
cd /opt/cloud
```

```shell
wget https://github.com/alibaba/nacos/releases/download/2.0.3/nacos-server-2.0.3.tar.gz

tar -zxvf nacos-server-2.2.3.tar.gz

cd /opt/cloud/nacos/
```

```shell
sudo vim /etc/systemd/system/nacos.service

[Unit]
Description=Nacos Server
After=network.target

[Service]
Type=forking
User=root
Group=root
WorkingDirectory=/opt/cloud/nacos
ExecStart=/bin/bash /opt/cloud/nacos/bin/startup.sh -m standalone
ExecStop=/bin/bash /opt/cloud/nacos/bin/shutdown.sh
Restart=on-failure
LimitNOFILE=65536
TimeoutStartSec=60
TimeoutStopSec=60
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

![](https://oss.yiki.tech/gmall/202512171600119.png)

```shell
sudo vim /opt/cloud/nacos/bin/startup.sh
[ ! -e "$JAVA_HOME/bin/java" ] && JAVA_HOME=/opt/java-se-8u44-ri
```

![](https://oss.yiki.tech/gmall/202512171601111.png)

```shell
sudo chmod +x /opt/cloud/nacos/bin/startup.sh

# 重新加载 systemd 配置
sudo systemctl daemon-reload

# 启用并启动 Nacos 服务
sudo systemctl enable nacos
sudo systemctl start nacos

# 查看 Nacos 服务状态
sudo systemctl status nacos
```

![](https://oss.yiki.tech/gmall/202512171615106.png)



### Sentinel 1.8.6

```shell
mkdir /opt/cloud
mkdir /opt/cloud/logs
cd /opt/cloud

wget wget https://github.com/alibaba/Sentinel/releases/download/1.8.6/sentinel-dashboard-1.8.6.ja
```

```shell
sudo vim /etc/systemd/system/sentinel-dashboard.service

[Unit]
Description=Sentinel Dashboard
After=network.target

[Service]
Type=simple
Environment="JAVA_HOME=/opt/java-se-8u44-ri"
ExecStart=/opt/java-se-8u44-ri/bin/java -jar /opt/cloud/sentinel-dashboard-1.8.2.jar
StandardOutput=file:/opt/cloud/logs/sentinel.log
StandardError=file:/opt/cloud/logs/sentinel_error.log
Restart=on-failure
User=root
Group=root
TimeoutStartSec=30

[Install]
WantedBy=multi-user.target
```

![](https://oss.yiki.tech/gmall/202512171605379.png)

```shell
# 重新加载 systemd 配置
sudo systemctl daemon-reload

# 启用 Sentinel Dashboard 开机自启：
sudo systemctl enable sentinel-dashboard


# 启动 Sentinel Dashboard 服务
sudo systemctl start sentinel-dashboard


# 查看服务状态
sudo systemctl status sentinel-dashboard
```

![](https://oss.yiki.tech/gmall/202512171616299.png)



### Zipkin 2.20.2

```shell
mkdir /opt/cloud
mkdir /opt/cloud/logs
cd /opt/cloud

wget https://repo1.maven.org/maven2/io/zipkin/zipkin-server/2.20.2/zipkin-server-2.20.2.jar
```



```shell
sudo vim /etc/systemd/system/zipkin-server.service

[Unit]
Description=Zipkin Server
After=network.target

[Service]
Type=simple
Environment="JAVA_HOME=/opt/java-se-8u44-ri"
ExecStart=/opt/java-se-8u44-ri/bin/java -jar /opt/cloud/zipkin-server-2.20.2-exec.jar
StandardOutput=file:/opt/cloud/logs/zipkin.log
StandardError=file:/opt/cloud/logs/zipkin_error.log
Restart=on-failure
User=root
Group=root
TimeoutStartSec=30

[Install]
WantedBy=multi-user.target
```

![](https://oss.yiki.tech/gmall/202512171605050.png)

```shell
# 重新加载 systemd 配置
sudo systemctl daemon-reload

# 启用开机自启：
sudo systemctl enable zipkin-server


# 启动 zipkin-server 服务
sudo systemctl start zipkin-server


# 检查服务状态
sudo systemctl status zipkin-server
```

![](https://oss.yiki.tech/gmall/202512171616817.png)



## Nginx 1.16.1

```shell
# 进入指定目录 下载 GCC 与 GCC-C++
cd /opt

yum -y install gcc

yum -y install gcc-c++
```

```shell
# 下载解压编译 pcre
wget http://downloads.sourceforge.net/project/pcre/pcre/8.37/pcre-8.37.tar.gz

tar -zxvf pcre-8.37.tar.gz

cd /opt/pcre-8.37/

./configure

make && make install

pcre-config --version

cd /opt

yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel
```

```shell
# 下载编译 nginx
cd /opt

wget http://nginx.org/download/nginx-1.16.1.tar.gz

tar -zxvf nginx-1.16.1.tar.gz

cd /opt/nginx-1.16.1/

./configure

make && make install
```

```shell
# 配置 Nginx 开机自启
vim /lib/systemd/system/nginx.service

[Unit]
Description=nginx
After=network.target
  
[Service]
Type=forking
ExecStart=/usr/local/nginx/sbin/nginx
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s quit
PrivateTmp=true
  
[Install]
WantedBy=multi-user.target


```

![](https://oss.yiki.tech/gmall/202512171618102.png)

```shell
# 重新加载配置
sudo systemctl daemon-reload

# 设置开机自启
systemctl enable nginx.service

# 查看nginx状态
systemctl status nginx.service

# 杀死nginx重启nginx
pkill -9 nginx
ps aux | grep nginx
systemctl start nginx

# 查看nginx状态
systemctl status nginx.service
```

```shell
# 启动命令
cd /usr/local/nginx/sbin
./nginx 

# 关闭命令
cd /usr/local/nginx/sbin
./nginx  -s  stop 

# 重新加载命令 
cd /usr/local/nginx/sbin
./nginx  -s  reload
```

![](https://oss.yiki.tech/gmall/202512171617968.png)



## Docker

```shell
# 卸载docker
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
                  
# 检查环境，安装gcc和g++
yum -y install gcc
yum -y install gcc-c++

# 安装必要的一些系统工具
yum install -y yum-utils device-mapper-persistent-data lvm2

# 添加软件源信息（设置阿里云镜像地址，提高下载速度）
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

# 更新yum软件包索引并安装Docker-CE
yum makecache fast

yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

```shell
# 查看 docker 服务的运行状态
systemctl status docker

# 启动 docker 服务
systemctl start docker

# 关闭 docker 服务
systemctl stop docker

# 重启 docker 服务
systemctl restart docker

# 设置 docker 开机自启
sudo systemctl enable docker
```



### Docker 配置镜像地址

```shell
vim /etc/docker/daemon.json

{
  "registry-mirrors": [
    "https://docker.1ms.run"
  ]
}
```

![](https://oss.yiki.tech/gmall/202512171553077.png)

```shell
# 重新加载文件和重启 docker
sudo systemctl daemon-reload
sudo systemctl restart docker
```



### RabbitMQ 3.12.0

```shell
# 下载镜像
docker pull rabbitmq:3.12-management

# 启动 网页地址 http://ip:15672/#/
docker run -d -p 5672:5672 -p 15672:15672 -p 25672:25672 --name rabbitmq rabbitmq:3.12-management

# 设置开机自启
docker update rabbitmq --restart=always
```

![](https://oss.yiki.tech/gmall/202512171618550.png)

### Elasticsearch 7.6.2

```shell
# 下载镜像
docker pull elasticsearch:7.6.2

# 启动 网页地址 http://ip:9200/
docker run --name elasticsearch7.6.2 -d -e ES_JAVA_OPTS="-Xms512m -Xmx512m" --net host -e "discovery.type=single-node" -p 9200:9200 -p 9300:9300 elasticsearch:7.6.2
```

```shell
# 创建目录
mkdir -p /mydata/es

# 进入目录
cd /mydata/es/

# 下载 ik 分词器
wget https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-7.6.2.zip

# 解压
unzip elasticsearch-analysis-ik-7.6.2.zip -d ik-analyzer

# 拷贝
docker cp ./ik-analyzer elasticsearch7.6.2:/usr/share/elasticsearch/plugins
```

```shell
# 重启 es
docker restart elasticsearch7.6.2

# 设置开机自启
docker update elasticsearch7.6.2 --restart=always
```

![](https://oss.yiki.tech/gmall/202512171619002.png)



### Kibana 7.6.2

```shell
# 下载镜像
docker pull kibana:7.6.2

# 运行 网页地址 http://ip:5601/
docker run --name kibana7.6.2 -p 5601:5601 -d kibana:7.6.2
```

```shell
# 进入容器内部
docker exec -it kibana7.6.2 bash

# 设置 es 地址 以及中文
vi /opt/kibana/config/kibana.yml
elasticsearch.hosts: [ "http://ip:9200" ]
i18n.locale: "zh-CN"

# 退出
exit
```

![](https://oss.yiki.tech/gmall/202512171551550.png)

```shell
# 重启 kibana
docker restart kibana7.6.2

# 设置开机自启
docker update kibana7.6.2 --restart=always
```

![](https://oss.yiki.tech/gmall/202512171619163.png)

## Gmall-admin

> 将 admin 服务打包上传自启动，后续将不用在开发机在启动该项目

```shell
cd /opt
mkdir /opt/gmall
```

![](https://oss.yiki.tech/gmall/202512171625648.png)

![](https://oss.yiki.tech/gmall/202512171630803.png)

```shell
sudo vim /etc/systemd/system/gmall-admin.service


[Unit]
Description=gmall-admin service
After=network.target

[Service]
Type=simple
Environment="JAVA_HOME=/opt/java-se-8u44-ri"
ExecStart=/opt/java-se-8u44-ri/bin/java -jar /opt/gmall/gmall-admin.jar
StandardOutput=file:/opt/gmall/logs/admin.log
StandardError=file:/opt/gmall/logs/admin_error.log
Restart=on-failure
User=root
Group=root
TimeoutStartSec=30

[Install]
WantedBy=multi-user.target
```

![](https://oss.yiki.tech/gmall/202512171623754.png)

```shell
ExecStart：启动 gmall-admin.jar 的命令。确保指定正确的 Java 路径和 gmall-admin.jar 文件的路径。
Environment="JAVA_HOME=/opt/java-se-8u44-ri"：明确设置 Java 环境变量，确保 systemd 可以找到 Java。
StandardOutput 和 StandardError：指定日志文件的路径，将标准输出和错误输出分别记录到 /opt/gmall/logs/admin.log 和 /opt/gmall/logs/admin_error.log。
Restart=on-failure：如果服务失败，它将自动重启。
TimeoutStartSec=30：设置服务启动时的超时时间为 30 秒。
User=root 和 Group=root：使用 root 用户启动服务，确保有足够的权限。如果你希望以其他用户身份启动服务，可以修改为适当的用户。


# 重新加载 systemd 配置
sudo systemctl daemon-reload

# 启用开机自启：
sudo systemctl enable gmall-admin


# 启动 gmall-admin 服务
sudo systemctl start gmall-admin


# 检查服务状态
sudo systemctl status gmall-admin
```

