# bigSave

## bigSave 录入数据过程

![](https://oss.yiki.tech/gmall/20251221161534793.png)

![](https://oss.yiki.tech/gmall/20251221161836671.png)

![](https://oss.yiki.tech/gmall/20251222034449408.png)

![](https://oss.yiki.tech/gmall/20251222040355464.png)

```json
{
  "name": "Apple iPhone 13 mini",
  "brandId": 4,
  "categoryId": 225,
  "publishStatus": 1,
  "spuImages": [
    "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/38d2c72e-06d6-4a26-8a41-9bf6a9a12064_0.jpg",
    "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/c726ec07-44db-41a1-84db-8a9072ccbc86_1.png",
    "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/89cb965f-b584-42b8-84f5-702bf542ff3c_2.jpg",
    "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/d3d98916-ac49-4550-8cfe-6ea43e689e0f_3.jpg",
    "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/ce09cc1a-ef0a-4b92-805a-17e496755a42_4.jpg"
  ],
  "baseAttrs": [
    {
      "attrId": 1,
      "attrName": "上市年份",
      "valueSelected": [
        "2021"
      ]
    },
    {
      "attrId": 2,
      "attrName": "产品名称",
      "valueSelected": [
        "iPhone 13 mini"
      ]
    },
    {
      "attrId": 10,
      "attrName": "上市月份",
      "valueSelected": [
        "九月"
      ]
    },
    {
      "attrId": 6,
      "attrName": "CPU品牌",
      "valueSelected": [
        "Apple"
      ]
    },
    {
      "attrId": 7,
      "attrName": "CPU型号",
      "valueSelected": [
        "A15"
      ]
    },
    {
      "attrId": 8,
      "attrName": "分辨率",
      "valueSelected": [
        "超视网膜XDR显示屏"
      ]
    },
    {
      "attrId": 9,
      "attrName": "屏幕尺寸",
      "valueSelected": [
        "5.4英寸（对角线）"
      ]
    }
  ],
  "skus": [
    {
      "attr_3": "星光色",
      "name_3": "机身颜色",
      "price": "1999",
      "stock": 0,
      "growBounds": "5000",
      "buyBounds": "6000",
      "work": [
        0,
        0,
        1,
        1
      ],
      "fullCount": "3",
      "discount": "60",
      "fullPrice": "2000",
      "reducePrice": "1999",
      "fullAddOther": 1,
      "images": [
        "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/4b5ab7bd-4f0c-4764-85c3-4ce97d95030a_2.jpg",
        "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/f45b537c-1447-423e-8550-8b36a27cc404_3.jpg",
        "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/8216b6cb-9b7c-4d97-868c-e92835526e87_4.jpg"
      ],
      "name": "Apple iPhone 13 mini 星光色,4GB,128G",
      "title": "Apple iPhone 13 mini 支持移动联通5G 星光色,4GB,128G",
      "subTitle": "Apple iPhone 13 mini 星光色,4GB,128G",
      "weight": "140",
      "attr_4": "4GB",
      "name_4": "运行内存",
      "attr_5": "128G",
      "name_5": "机身存储",
      "ladderAddOther": 1,
      "subtitle": "【限时特惠】加99元得20W快充头！加799得AirPods耳机！更多优惠！查看>",
      "saleAttrs": [
        {
          "attrId": "3",
          "attrName": "机身颜色",
          "attrValue": "星光色"
        },
        {
          "attrId": "4",
          "attrName": "运行内存",
          "attrValue": "4GB"
        },
        {
          "attrId": "5",
          "attrName": "机身存储",
          "attrValue": "128G"
        }
      ]
    },
    {
      "price": "2599",
      "stock": 0,
      "growBounds": "3000",
      "buyBounds": "2000",
      "work": [
        1,
        0,
        0,
        1
      ],
      "fullCount": 1,
      "discount": "95",
      "fullPrice": "2500",
      "reducePrice": "2499",
      "fullAddOther": 1,
      "images": [
        "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/cf5d3632-ba9e-403e-854d-b4c896012942_4.jpg",
        "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/3d48320e-092d-437f-8b13-fc23fd61a067_3.jpg",
        "https://yiki-gmall.oss-cn-hangzhou.aliyuncs.com/2025-12-21/8d51c751-c13f-4067-8a27-2dd89add18e6_2.jpg"
      ],
      "name": "Apple iPhone 13 mini 星光色,4GB,256G",
      "title": "Apple iPhone 13 mini 支持移动联通5G 星光色,4GB,256G",
      "subTitle": "Apple iPhone 13 mini 星光色,4GB,256G",
      "weight": "140",
      "ladderAddOther": 0,
      "subtitle": "【限时特惠】加99元得20W快充头！加799得AirPods耳机！更多优惠！查看>",
      "saleAttrs": [
        {
          "attrId": "3",
          "attrName": "机身颜色",
          "attrValue": "星光色"
        },
        {
          "attrId": "4",
          "attrName": "运行内存",
          "attrValue": "4GB"
        },
        {
          "attrId": "5",
          "attrName": "机身存储",
          "attrValue": "256G"
        }
      ]
    }
  ]
}
```

> 即保存了红框内 9 张表的数据

![](https://oss.yiki.tech/gmall/20251222042216493.png)

## 封装 bigSave 接收对象

> 为了保存数据，首先我们需要将页面传递的数据全部接收到。折叠前端发送的 Json 可以发现 Spu 表对应的实体类已经包含了前端发送的几个核心字段，但仅凭 Spu 对应的实体类是不能满足接收全部数据的需求。为了保证数据库实体与接口数据的职责分离、确保安全性、灵活性和可维护性，需要使用专门的DTO/VO来接收前端数据，而不是直接扩展实体类。

![](https://oss.yiki.tech/gmall/20251222041746871.png)

### SpuVo

> 因为 SpuEntity 中已经有了大多数字段，所以我们可以创建一个 SpuVo 去继承 SpuEntity 在去扩展 **spuImages**、**baseAttrs**、**skus** 这三个字段即可。首先是 **spuImages**，展开发现其内容是 字符串集合，可以使用 List<String> 去接收

![](https://oss.yiki.tech/gmall/20251222043951772.png)

> baseAttrs 与 skus 展开后里面的数据也无法直接使用对应表的实体类进行接收，所有泛型先用 ? 进行替代等创建好对应的 Vo 后进行填充

```java
@Data
public class SpuVo extends SpuEntity {

    // 图片信息
    List<String> spuImages;

    // 基本属性信息
    private List<?> baseAttrs;

    // sku 信息
    private List<?> skus;

}
```

### SpuAttrValueVo

> 展开后可以发现内部就是基础属性 SpuAttrValueEntity 对应的的数据。创建 SpuAttrValueVo 去继承该类，重写 set 方法将 **valueSelected** 属性转换为 **attrValue** 即可

![](https://oss.yiki.tech/gmall/20251222045334408.png)

```java
public class SpuAttrValueVo extends SpuAttrValueEntity {

    public void setValueSelected(List<String> valueSelected) {

        // 如果接受的集合为空, 则不设置
        if (CollectionUtils.isEmpty(valueSelected)) {
            return;
        }

        // 将接受的集合根据 "," 分割为字符串 赋值给 AttrValue 属性
        setAttrValue(StringUtils.join(valueSelected, ","));
    }

}
```

> 将新创建的 SpuAttrValueVo 替换掉 spuVo 类 基本属性信息 中的泛型即可

```java
@Data
public class SpuVo extends SpuEntity {

    // 图片信息
    List<String> spuImages;

    // 基本属性信息
    private List<SpuAttrValueVo> baseAttrs;

    // sku 信息
    private List<?> skus;

}
```



### SkuVo

> 展开对应 Json 发现可以使用继承 Sku 对应实体类保存大多数字段，扩展剩余没有的字段即可

![](https://oss.yiki.tech/gmall/20251222051118384.png)

![](https://oss.yiki.tech/gmall/20251222051351616.png)

![](https://oss.yiki.tech/gmall/20251222051612322.png)

#### 营销信息相关数据

> 剩下的都是 sku 对应的营销相关数据，分别在  SkuBoundsEntity、SkuFullReductionEntity、SkuLadderEntity 找到出处，复制于 SkuVo 中即可

![](https://oss.yiki.tech/gmall/20251222051819336.png)

![](https://oss.yiki.tech/gmall/20251222051858380.png)

![](https://oss.yiki.tech/gmall/20251222052059587.png)

![](https://oss.yiki.tech/gmall/20251222052143568.png)

![](https://oss.yiki.tech/gmall/20251222052255548.png)

![](https://oss.yiki.tech/gmall/20251222052324663.png)

```java
@Data
public class SkuVo extends SkuEntity {

    // sku 的 图片列表
    private List<String> images;

    // 销售属性
    private List<SkuAttrValueEntity> saleAttrs;

    /*                       积分优惠信息                       */

    /**
     * 成长积分
     */
    private BigDecimal growBounds;
    /**
     * 购物积分
     */
    private BigDecimal buyBounds;
    /**
     * 优惠生效情况[1111（四个状态位，从右到左）;0 - 无优惠，成长积分是否赠送;1 - 无优惠，购物积分是否赠送;2 - 有优惠，成长积分是否赠送;3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]
     */
//    private Integer work;
    private List<Integer> work;

    /*                       满减优惠信息                       */

    /**
     * 满多少
     */
    private BigDecimal fullPrice;
    /**
     * 减多少
     */
    private BigDecimal reducePrice;
    /**
     * 是否参与其他优惠
     */
//    private Integer addOther;
    private Integer fullAddOther;

    /*                       打折优惠信息                       */

    /**
     * 满几件
     */
    private Integer fullCount;
    /**
     * 打几折
     */
    private BigDecimal discount;
    /**
     * 是否叠加其他优惠[0-不可叠加，1-可叠加]
     */
//    private Integer addOther;
    private Integer ladderAddOther;

}
```

> 最后将 SkuVo 替换掉 spuVo 类 sku 信息 中的泛型即可

```java
@Data
public class SpuVo extends SpuEntity {

    // 图片信息
    List<String> spuImages;

    // 基本属性信息
    private List<SpuAttrValueVo> baseAttrs;

    // sku 信息
    private List<SkuVo> skus;

}
```

## 测试是否能够接收全部的数据

> 根据请求路径寻找到对应的接口，替换原有接收对象 SpuEntity 替换成 SpuVo。后端打断点后前端提交数据进行检验是否全部接收

![](https://oss.yiki.tech/gmall/20251222052839195.png)

![](https://oss.yiki.tech/gmall/20251222053842318.png)

## 保存思路分析

> 一共需要保存 9 张表且顺序不能颠倒，例如：保存完 spu 信息后才能获取到 spuId 从而在保存其他表时设置 spuId

```java
    @Override
    public void bigSave(SpuVo spu) {
        // 1. 保存 spu 相关信息
        // 1.1 保存 spu 表
        // 1.2 保存 pms_spu_desc 本质与 spu 是同一张表
        // 1.3 保存 pms_spu_attr_value 基本属性值表

        // 2. 保存 sku 相关信息
        // 2.1 保存 pms_sku
        // 2.2 保存 pms_sku_images 本质与 sku 是同一张表, 如果不为空才需要保存图片
        // 2.3 保存 pms_sku_attr_value 销售属性值表

        // 3. 保存 营销 相关信息
        // 3.1 保存积分优惠表
        // 3.2 保存满减优惠表
        // 3.3 保存打折优惠表
    }
```

